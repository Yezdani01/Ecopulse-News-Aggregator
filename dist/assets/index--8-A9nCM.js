(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class h{constructor(){this.nextPage=null,this.isFetching=!1,this.API_KEY="pub_613708a31479c0eb76bb7a9497ea3f8a10eae",this.BASE_URL="https://newsdata.io/api/1/news"}async translateText(e,t){if(!e||t==="en")return e;try{const s=await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${t}&dt=t&q=${encodeURIComponent(e)}`);if(!s.ok)throw new Error("Translation API failed");return(await s.json())[0][0][0]}catch(s){return console.warn("Translation failed:",s),e}}async fetchNews(e,t,s=null){if(this.isFetching)return null;this.isFetching=!0;try{const i=new URLSearchParams({apikey:this.API_KEY,q:e||"ai",country:t.country,language:"en",category:t.category});s&&i.append("page",s);const n=`${this.BASE_URL}?${i.toString()}`,l=await(await fetch(n)).json();if(l.status==="error")throw new Error(l.message||"API returned an error");return this.nextPage=l.nextPage||null,t.language!=="en"&&l.results?await Promise.all(l.results.map(async c=>({...c,title:await this.translateText(c.title,t.language),description:c.description?await this.translateText(c.description,t.language):null,targetLanguage:t.language}))):l.results||[]}catch(i){throw new Error(`Failed to fetch news: ${i.message}`)}finally{this.isFetching=!1}}}function u(a,e){const t=document.createElement("article");t.className="news-card";const s=a.description||"No description available",i=p(s,150),n="https://images.unsplash.com/photo-1504711434969-e33886168f5c?q=80&w=800&auto=format&fit=crop",r=a.link;return t.innerHTML=`
        <div class="card-image-container">
            <img 
                src="${a.image_url||n}" 
                alt="${d(a.title)}"
                class="card-image"
                loading="lazy"
                onerror="this.src='${n}'"
            >
        </div>
        <div class="card-content">
            <h2 class="card-title">${d(a.title)}</h2>
            <p class="card-description">${d(i)}</p>
        </div>
        <div class="card-footer">
            <span class="source">${d(a.source_id||"Unknown Source")}</span>
            <button class="button read-more-btn" onclick="openArticle('${r}', ${e}, '${a.targetLanguage||""}')">Read More</button>
        </div>
    `,t}window.openArticle=function(a,e,t){if(e&&t){const s=`https://translate.google.com/translate?sl=auto&tl=${t}&u=${encodeURIComponent(a)}`;window.open(s,"_blank")}else window.open(a,"_blank")};function g(a){document.documentElement.setAttribute("lang",a)}function o(a){const e=document.getElementById("loading");e&&(e.style.display=a?"flex":"none")}function p(a,e){return a.length<=e?a:a.substr(0,e).trim()+"..."}function d(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}class m{constructor(){this.theme=localStorage.getItem("theme")||"light",this.init()}init(){this.applyTheme(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setupToggle()):this.setupToggle()}applyTheme(){document.documentElement.setAttribute("data-theme",this.theme),localStorage.setItem("theme",this.theme)}setupToggle(){const e=document.createElement("button");e.className="theme-toggle",e.setAttribute("aria-label","Toggle theme"),e.setAttribute("title",`Switch to ${this.theme==="light"?"dark":"light"} mode`),this.theme==="dark"&&e.classList.add("dark"),e.innerHTML=`
            <div class="icons">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </div>
        `,e.addEventListener("click",()=>{this.toggleTheme(),e.setAttribute("title",`Switch to ${this.theme==="light"?"dark":"light"} mode`)});const t=document.querySelector(".header-content");if(t){let s=t.querySelector(".header-left");if(!s){s=document.createElement("div"),s.className="header-left";const i=t.querySelector(".header-title"),n=t.querySelector("svg");i&&s.appendChild(i),n&&s.insertBefore(n,i),t.insertBefore(s,t.firstChild)}t.appendChild(e)}}toggleTheme(){this.theme=this.theme==="light"?"dark":"light",this.applyTheme();const e=document.querySelector(".theme-toggle");e&&(e.classList.toggle("dark"),e.classList.add("theme-toggle-animation"),setTimeout(()=>e.classList.remove("theme-toggle-animation"),300))}}class f{constructor(){this.api=new h,this.state={category:"technology",country:"in",language:"en"},this.originalArticles=[],this.displayedArticles=[],this.initializeUI(),this.setupEventListeners(),this.loadInitialNews(),this.chat=new ChatUI,this.themeManager=new m}initializeUI(){document.querySelector(".header-title").textContent="Echopulse",Object.entries(this.state).forEach(([e,t])=>{const s=document.getElementById(e);s&&(s.value=t)})}setupEventListeners(){var e,t;["category","country"].forEach(s=>{var i;(i=document.getElementById(s))==null||i.addEventListener("change",n=>{this.state[s]=n.target.value})}),(e=document.getElementById("language"))==null||e.addEventListener("change",async s=>{const i=s.target.value;this.state.language=i,this.originalArticles.length>0&&await this.translateArticles(i)}),(t=document.getElementById("search-button"))==null||t.addEventListener("click",()=>{this.refreshNews()}),window.addEventListener("scroll",this.handleScroll.bind(this))}async translateArticles(e){if(this.originalArticles.length){o(!0);try{if(e==="en"){this.displayedArticles=[...this.originalArticles],this.updateDisplay(!1);return}const t=await Promise.all(this.originalArticles.map(async s=>({...s,title:await this.api.translateText(s.title,e),description:s.description?await this.api.translateText(s.description,e):null,targetLanguage:e})));this.displayedArticles=t,this.updateDisplay(!0),g(e)}catch(t){console.error("Translation failed:",t)}finally{o(!1)}}}updateDisplay(e){const t=document.getElementById("news-grid");t.innerHTML="",this.displayedArticles.forEach(s=>{const i=u(s,e);t.appendChild(i)})}async loadInitialNews(){try{o(!0);const e=await this.api.fetchNews("ai",{...this.state,language:"en"});this.originalArticles=e,this.displayedArticles=[...e],this.state.language!=="en"?await this.translateArticles(this.state.language):this.updateDisplay(!1)}catch(e){console.error("Failed to load news:",e)}finally{o(!1)}}async refreshNews(){try{const e=document.getElementById("news-grid");e.innerHTML="",this.api.nextPage=null,o(!0);const t=await this.api.fetchNews("ai",{...this.state,language:"en"});this.originalArticles=t,this.displayedArticles=[...t],this.state.language!=="en"?await this.translateArticles(this.state.language):this.updateDisplay(!1)}catch(e){console.error("Failed to refresh news:",e)}finally{o(!1)}}async loadMoreNews(){if(!(!this.api.nextPage||this.api.isFetching))try{const e=await this.api.fetchNews("ai",{...this.state,language:"en"},this.api.nextPage);if(e!=null&&e.length)if(this.originalArticles=[...this.originalArticles,...e],this.state.language!=="en"){const t=await Promise.all(e.map(async s=>({...s,title:await this.api.translateText(s.title,this.state.language),description:s.description?await this.api.translateText(s.description,this.state.language):null,targetLanguage:this.state.language})));this.displayedArticles=[...this.displayedArticles,...t],this.updateDisplay(!0)}else this.displayedArticles=[...this.displayedArticles,...e],this.updateDisplay(!1)}catch(e){console.error("Failed to load more news:",e)}}handleScroll(){window.innerHeight+window.scrollY>=document.body.offsetHeight-500&&this.api.nextPage&&!this.api.isFetching&&this.loadMoreNews()}}document.addEventListener("DOMContentLoaded",()=>{new f});
